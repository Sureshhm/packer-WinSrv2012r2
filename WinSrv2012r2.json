{
  "variables": {
    "packer_win_pass": "{{env `PACKER_WIN_PASS`}}",
    "wsus_server": "{{env `WSUS_SERVER`}}",
    "wsus_group": "{{env `WSUS_GROUP`}}"
  },
  "builders": [
    {
      "type": "vmware-iso",
      "communicator": "winrm",
      "skip_compaction": "false",
      "headless": false,
      "output_directory": "VM/WinSrv2012r2",
      "vm_name": "WinSrv2012r2",
      "vmdk_name": "WinSrv2012r2",
      "iso_url": "ISO/en_windows_server_2012_r2_vl_with_update_x64_dvd_4065221.iso",
      "iso_checksum_type": "md5",
      "iso_checksum": "b52450dd5ba8007e2934f5c6e6eda0ce",
      "boot_wait": "6m",
      "winrm_username": "packer",
      "winrm_password": "packer1!",
      "winrm_timeout": "2h",
      "shutdown_command": "shutdown /s /t 0",
      "shutdown_timeout": "30m",
      "guest_os_type": "windows8srv-64",
      "disk_size": "102400",
      "disk_type_id": "0",
      "floppy_files": [
        "answer_files/2012_r2/Autounattend.xml",
        "scripts/bootstrap-win.ps1",
        "FILES/pvscsi",
        "FILES/vmxnet3"
        ],
      "vmx_data": {
        "ethernet0.virtualdev" : "vmxnet3",
        "virtualhw.productcompatibility" : "esx",
        "virtualhw.version" : "10",
        "vcpu.hotadd": "TRUE",
        "mem.hotadd": "TRUE",
        "memsize": "8192",
        "scsi0.virtualDev": "pvscsi",
        "numvcpus": "6",
        "cpuid.coresPerSocket": "6",
        "hypervisor.cpuid.v1": "FALSE",
        "tools.upgrade.policy": "manual",
        "tools.syncTime": "0",
        "time.synchronize.continue": "1",
        "time.synchronize.restore": "1",
        "time.synchronize.resume.disk": "1",
        "time.synchronize.shrink": "1",
        "time.synchronize.tools.startup": "1",
        "time.synchronize.tools.enable": "1",
        "time.synchronize.resume.host": "1"
         },
        "vmx_data_post": {
        "memsize" : "4096",
        "numvcpus" : "1",
        "cpuid.coresPerSocket": "1",
        "ide1:0.startConnected" : "FALSE",
        "ide1:0.deviceType" : "atapi-cdrom",
        "ide1:0.fileName" : "cdrom0",
        "ide1:0.present" : "TRUE"
       }
     }
    ],
  "provisioners": [
    {
      "type": "file",
      "source": "FILES/setup64.exe",
      "destination": "C:/Windows/Temp/setup64.exe"
    },
    {
      "type": "file",
      "source": "FILES/ultradefrag-portable-6.0.4.bin.amd64.zip",
      "destination": "C:/Windows/Temp/ultradefrag-portable-6.0.4.bin.amd64.zip"
    },
    {
      "type": "file",
      "source": "FILES/SDelete.zip",
      "destination": "C:/Windows/Temp/SDelete.zip"
    },
    {
      "type": "file",
      "source": "FILES/vmware.cer",
      "destination": "C:/Windows/Temp/vmware.cer"
    },    
    {
      "type": "file",
      "source": "FILES/certmgr.exe",
      "destination": "C:/Windows/Temp/certmgr.exe"
    },
    {
      "type": "powershell",
      "scripts": "scripts/tools-win.ps1",
      "remote_path": "c:/windows/temp/tools-win-new.ps1",
      "execute_command": "c:/windows/temp/tools-win.ps1"
    }
  ]
} 